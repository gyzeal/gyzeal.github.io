<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>初识大语言模型训练中 GPU 显存分配（初学者） - Agent学习笔记</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <div class="layout">
        <!-- 左侧边栏，与首页/分类页保持一致的 Blog 风格 -->
        <aside class="sidebar">
            <div class="profile">
                <img src="../self.jpg" alt="Profile Photo" class="avatar">
                <h2 class="name">gyZeal</h2>
                <p class="bio">以清净心而宏大愿</p>
                <p class="bio">以智慧力而降诸魔</p>
            </div>

            <nav class="nav">
                <a href="../index.html">Posts</a>
                <a href="../art.html">艺术类</a>
                <a href="../agent.html" class="active">Agent开发</a>
                <a href="../rl.html">RL学习</a>
            </nav>

            <div class="contact">
                <a href="mailto:your@email.com">Email</a>
                <a href="https://github.com/gyzeal" target="_blank">GitHub</a>
            </div>
        </aside>

        <!-- 右侧正文，使用 Blog 风格的文章排版 -->
        <main class="main-content">
            <article class="post-container">
                <header class="post-header">
                    <h1>初识大语言模型训练中 GPU 显存分配（初学者）</h1>
                    <div class="post-info">
                        <span>2025年12月2日</span>
                        <span>Agent</span>
                    </div>
                </header>

                <section class="post-content">
                    <h2>1. 前向传播</h2>

                    <h3>1.1 权重加载到 GPU 显存</h3>
                    <p>
                        首先将权重（<code>.pth</code>、<code>.safetensors</code>）加载进 GPU 显存（VRAM）中。
                        模型权重的数据类型（<code>fp32</code>、<code>bf16</code>、<code>fp16</code>、<code>int8</code> 等）
                        决定了占用多少显存。
                    </p>

                    <p><strong>显存估算公式：</strong></p>
                    <p>
                        对于一个具有 \(n\) Billion 参数的模型，其权重占用显存约为：
                    </p>
                    <pre><code>Param Memory ≈ n × 10^9 × Bytes(fp32 / bf16 / fp16 / int8 ...)</code></pre>

                    <p><strong>是否有策略可以缓解显存占用？</strong></p>
                    <pre><code>1. 参数量化策略</code></pre>

                    <h3>1.2 激活值（Activation）显存占用</h3>
                    <p>
                        其次开始处理数据 \((B, L, H)\)。
                        每一层 Layer 的输出（\(X\)）都需要存下来，因为反向传播算梯度时要用到它，链式法则：
                    </p>

                    <pre><code>dL/dW = dL/dY · X</code></pre>

                    <p>
                        此时，激活值所占用的显存可通过如下公式粗略计算：
                    </p>
                    <pre><code>Activation Memory ≈
Layers × Batch Size × Seq Len × Hidden Size × Bytes</code></pre>

                    <p><strong>那么是否有策略可以缓解激活值带来的高昂显存占用？例如：</strong></p>
                    <pre><code>1. 梯度检查点
2. Flash Attention 2
3. 激活值卸载
4. 序列并行：将序列 L 切分成 N 份（N = GPU 数量），每张卡只存 L/N 的激活值</code></pre>
                </section>

                <footer class="post-footer">
                    <a href="../agent.html" class="back-link">← 返回Agent目录</a>
                </footer>
            </article>
        </main>
    </div>
</body>
</html>
